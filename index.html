<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bus Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    .login-page {
      height: 100vh; display: flex; justify-content: center; align-items: center;
      background: linear-gradient(135deg, #ff7eb3, #65d6ce);
    }
    .login-box {
      background: white; padding: 30px; border-radius: 15px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
      width: 320px; text-align: center;
    }
    .login-box h1 { color: #2c3e50; margin-bottom: 20px; }
    input {
      width: 90%; padding: 10px; margin: 10px 0;
      border-radius: 10px; border: 1px solid #ccc;
    }
    button {
      width: 95%; padding: 12px; margin: 10px 0;
      border: none; border-radius: 10px;
      background: #3498db; color: white; font-size: 16px; cursor: pointer;
    }
    button:hover { background: #2980b9; }
    .map-page { display: none; height: 100vh; flex-direction: column; }
    #map { flex: 1; width: 100%; }
    .controls {
      padding: 10px; text-align: center; background: #f4f4f4;
    }
    .controls select, .controls button {
      margin: 5px; padding: 10px; border-radius: 8px; border: 1px solid #ccc;
    }
    footer {
      text-align: right; font-size: 12px; padding: 5px; background: #eee;
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div class="login-page" id="loginPage">
    <div class="login-box">
      <h1>Bus Tracker</h1>
      <input type="email" id="email" placeholder="Enter Email" required>
      <input type="password" id="password" placeholder="Enter Password" required>
      <button onclick="login()">Login</button>
      <button onclick="signup()">Create Account</button>
    </div>
  </div>

  <!-- Map Page -->
  <div class="map-page" id="mapPage">
    <div id="map"></div>
    <div class="controls">
      <select id="busSelect">
        <option value="bus1">Bus 1</option>
        <option value="bus2">Bus 2</option>
      </select>
      <button onclick="startTracking()">Start Tracking</button>
      <button onclick="stopTracking()">Stop Tracking</button>
    </div>
    <footer>Developed by Archit Sharma</footer>
  </div>

  <!-- Firebase + Google Maps -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBy_ieIzByu1uYgW1FEaM5vXUW9QeYal4"></script>

  <script>
    // 🔹 Replace with your Firebase config
    const firebaseConfig = {
       apiKey: "AIzaSyAk8hV0jAR3G0tCi1Fhw-I4Ln25yDRiGbg",
      authDomain: "trackingapparchit.firebaseapp.com",
      databaseURL: "https://trackingapparchit-default-rtdb.firebaseio.com",
      projectId: "trackingapparchit",
      storageBucket: "trackingapparchit.appspot.com",
      messagingSenderId: "971227243188",
      appId: "1:971227243188:web:6b104c1dc750e429a4ede1"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Login function
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mapPage").style.display = "flex";
          initMap();
        })
        .catch(e => alert(e.message));
    }

    // Signup function
    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("Account Created! Now Login"))
        .catch(e => alert(e.message));
    }

    let map, busMarker, userMarker, trackingRef;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 28.6139, lng: 77.2090 }, // Default: Delhi
        zoom: 14
      });

      busMarker = new google.maps.Marker({
        map: map,
        label: "🚌"
      });

      userMarker = new google.maps.Marker({
        map: map,
        label: "📍",
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          fillColor: "blue",
          fillOpacity: 0.9,
          strokeWeight: 2,
          strokeColor: "white"
        }
      });
    }

    function startTracking() {
      // 🔹 Show user's current location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const myPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          userMarker.setPosition(myPos);
          map.setCenter(myPos);
        }, err => {
          alert("Unable to fetch your location.");
        });
      }

      // 🔹 Track bus from Firebase
      const bus = document.getElementById("busSelect").value;
      trackingRef = db.ref("buses/" + bus);
      trackingRef.on("value", snapshot => {
        const data = snapshot.val();
        if (data) {
          const busPos = { lat: data.lat, lng: data.lng };
          busMarker.setPosition(busPos);
        }
      });
    }

    function stopTracking() {
      if (trackingRef) trackingRef.off();
      alert("Tracking Stopped");
    }
  </script>
</body>
</html>
